<project name="juddi-tomcat" default="package-tomcat" basedir=".">
	<property file="package.properties"/>
	<property name="common.lib.dir" value="${basedir}/target/tomcat/apache-tomcat-${apache.tomcat.version}/common/lib"/>
	<property name="webapps.dir" value="${basedir}/target/tomcat/apache-tomcat-${apache.tomcat.version}/webapps"/>

	<target name="unzip-tomcat">
		<mkdir dir="${basedir}/target/tomcat"/>

		<unzip dest="${basedir}/target/tomcat" src="target/apache-tomcat-5.5.23.zip"/>
		<unzip dest="${webapps.dir}/juddi" src="target/juddi-web-2.0rc6.war"/>
		<copy file="${basedir}/target/juddi-soapconsole-2.0rc6.war" tofile="${webapps.dir}/juddi-console.war"/>
	</target>
	
	<target name="copy-resources" depends="unzip-tomcat">
	
		<copy file="juddi.xml" todir="${basedir}/target/tomcat/apache-tomcat-${apache.tomcat.version}/conf/Catalina/localhost"/>
		<copy file="${basedir}/target/derby-10.1.2.1.jar" todir="${common.lib.dir}"/>
		<copy file="${basedir}/target/axis-1.4.jar" todir="${common.lib.dir}"/>
		<copy file="${basedir}/target/axis-saaj-1.4.jar" todir="${common.lib.dir}"/>
		<copy file="${basedir}/target/axis-jaxrpc-1.4.jar" todir="${common.lib.dir}"/>
		<copy file="${basedir}/target/commons-discovery-0.2.jar" todir="${common.lib.dir}"/>
		<replace file="${webapps.dir}/juddi/WEB-INF/juddi.properties">
			<replacetoken>juddi-sql/mysql</replacetoken>
			<replacevalue>juddi-sql/derby</replacevalue>
		</replace>
		<replace file="${webapps.dir}/juddi/WEB-INF/juddi.properties">
			<replacetoken>#juddi.jdbcUrl=jdbc:mysql://localhost/juddi</replacetoken>
			<replacevalue>juddi.jdbcUrl=jdbc:derby:juddi-derby-test-db;create=true</replacevalue>
		</replace>
	        <replace file="${webapps.dir}/juddi/WEB-INF/juddi.properties">
                        <replacetoken>#juddi.jdbcDriver=com.mysql.jdbc.Driver</replacetoken>
                        <replacevalue>juddi.jdbcDriver=org.apache.derby.jdbc.EmbeddedDriver</replacevalue>
                </replace>	
	</target>
	
	<target name="package-tomcat" depends="copy-resources">
		<zip destfile="target/juddi-tomcat.zip" 
			basedir="target/tomcat"/>
			
	</target>
</project>
